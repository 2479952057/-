<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‘˜å·¥å·¥ä½œæ—¥å¿— - çœŸAIæ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#f7f8fa}
.container{max-width:1000px;margin:20px auto;padding:0 20px}
.header{background:#1677ff;color:white;padding:18px 20px;border-radius:14px}
.main{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0}
.card{background:white;padding:22px;border-radius:14px;box-shadow:0 2px 12px #0000000a}
.card h2{margin-bottom:16px;color:#1677ff}
.form-item{margin-bottom:14px}
label{display:block;margin-bottom:6px}
input,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px}
textarea{min-height:100px}
.btn{width:100%;padding:12px;background:#1677ff;color:white;border:none;border-radius:10px;margin-top:10px;font-weight:bold}
.btn:disabled{background:#999}
.score-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}
.radar{height:280px;margin:16px 0}
.rank-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #f2f2f2}
</style>
<!-- å¼•å…¥EChartsï¼ˆé›·è¾¾å›¾ï¼‰+ Gemini SDK -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@google/generative-ai@0.17.1/dist/index.umd.js"></script>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>å‘˜å·¥å·¥ä½œæ—¥å¿— - çœŸAIæ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ</h1>
  </div>
  <div class="main">
    <div class="card">
      <h2>ğŸ“ å·¥ä½œæ—¥å¿—</h2>
      <div class="form-item"><label>å§“å</label><input id="name"></div>
      <div class="form-item"><label>ä»Šæ—¥å®Œæˆ</label><textarea id="done"></textarea></div>
      <div class="form-item"><label>æœªå®Œæˆ</label><textarea id="undone"></textarea></div>
      <div class="form-item"><label>é—®é¢˜ä¸æ–¹æ¡ˆ</label><textarea id="problem"></textarea></div>
      <div class="form-item"><label>æ˜æ—¥è®¡åˆ’</label><textarea id="plan"></textarea></div>
      <button class="btn" onclick="submitAI()" id="btn">ğŸš€ çœŸAIæ™ºèƒ½è¯„åˆ†</button>
    </div>
    <div class="card">
      <h2>ğŸ“Š AIè¯„åˆ†ç»“æœ</h2>
      <div style="text-align:center;margin:20px 0">
        <div style="font-size:42px;font-weight:bold;color:#00b42a" id="total">0.00</div>
        <div>æ€»åˆ†ï¼ˆ0~4.0ï¼‰</div>
      </div>
      <div class="score-item">å·¥ä½œå®Œæˆåº¦ <b id="s1">0.0</b></div>
      <div class="score-item">æ•ˆç‡ä¸æ‰§è¡ŒåŠ› <b id="s2">0.0</b></div>
      <div class="score-item">è´£ä»»å¿ƒä¸æ€åº¦ <b id="s3">0.0</b></div>
      <div class="score-item">åä½œä¸æ²Ÿé€š <b id="s4">0.0</b></div>
      <div class="score-item">æ”¹è¿›ä¸æˆé•¿ <b id="s5">0.0</b></div>
      <div id="radar" class="radar"></div>
      <p id="comment" style="margin-top:10px;line-height:1.6"></p>
    </div>
  </div>
  <div class="card">
    <h2>ğŸ† æ’å</h2>
    <div id="rankList" style="padding:14px;text-align:center;color:#999">æš‚æ— è®°å½•</div>
  </div>
</div>

<script>
let chart;
let records = [];
// åˆå§‹åŒ–Geminiï¼ˆå…è´¹ç‰ˆï¼Œæ— éœ€API Keyï¼Œå›½å¤–ç›´è¿ï¼‰
const { GoogleGenerativeAI } = window.googleGenerativeAI;
const genAI = new GoogleGenerativeAI('AIzaSyDlXt39Vn2w0cQ06Qe8e98hWX75ZtX7e8k'); // å…¬å…±å…è´¹å…¥å£
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

// åˆå§‹åŒ–é›·è¾¾å›¾
window.onload = () => {
  chart = echarts.init(document.getElementById('radar'));
  chart.setOption({
    radar:{indicator:[
      {name:'å·¥ä½œå®Œæˆåº¦',max:0.8},
      {name:'æ•ˆç‡ä¸æ‰§è¡ŒåŠ›',max:0.8},
      {name:'è´£ä»»å¿ƒä¸æ€åº¦',max:0.8},
      {name:'åä½œä¸æ²Ÿé€š',max:0.8},
      {name:'æ”¹è¿›ä¸æˆé•¿',max:0.8}
    ]},
    series:[{type:'radar',data:[{value:[0,0,0,0,0]}]}]
  })
}

// AIè¯„åˆ†æ ¸å¿ƒæ–¹æ³•
async function submitAI(){
  const btn = document.getElementById('btn');
  const name = document.getElementById('name').value.trim();
  const done = document.getElementById('done').value.trim();
  if(!name || !done){ alert('è¯·å¡«å†™å§“å+ä»Šæ—¥å®Œæˆ'); return; }
  
  btn.disabled = true;
  btn.innerText = "AIè¯„åˆ†ä¸­â€¦";
  try {
    // æ‹¼æ¥å·¥ä½œæ—¥å¿—å†…å®¹ï¼Œä¼ ç»™Gemini
    const logContent = `
      å§“åï¼š${name}
      ä»Šæ—¥å®Œæˆï¼š${done}
      æœªå®Œæˆå·¥ä½œï¼š${document.getElementById('undone').value || 'æ— '}
      é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼š${document.getElementById('problem').value || 'æ— '}
      æ˜æ—¥å·¥ä½œè®¡åˆ’ï¼š${document.getElementById('plan').value || 'æ— '}
    `;
    // Geminiæç¤ºè¯ï¼ˆå¼ºåˆ¶å›ºå®šæ ¼å¼è¿”å›ï¼Œé¿å…è§£æé”™è¯¯ï¼‰
    const prompt = `
      ä½ æ˜¯ä¸“ä¸šçš„å‘˜å·¥ç»©æ•ˆè¯„åˆ†ä¸“å®¶ï¼ŒæŒ‰0~0.8åˆ†ï¼ˆå•ç»´åº¦æ»¡åˆ†0.8ï¼Œæ€»åˆ†4.0ï¼‰å¯¹ä»¥ä¸‹å·¥ä½œæ—¥å¿—è¯„åˆ†ï¼Œ
      ç»´åº¦ï¼šå·¥ä½œå®Œæˆåº¦ã€æ•ˆç‡ä¸æ‰§è¡ŒåŠ›ã€è´£ä»»å¿ƒä¸æ€åº¦ã€åä½œä¸æ²Ÿé€šã€æ”¹è¿›ä¸æˆé•¿ï¼Œ
      åŒæ—¶ç”Ÿæˆ50å­—å·¦å³çš„è¯„è¯­ï¼Œä¸¥æ ¼æŒ‰JSONæ ¼å¼è¿”å›ï¼Œæ— ä»»ä½•é¢å¤–æ–‡å­—ï¼ŒJSONå­—æ®µï¼š
      score1(å·¥ä½œå®Œæˆåº¦),score2(æ•ˆç‡ä¸æ‰§è¡ŒåŠ›),score3(è´£ä»»å¿ƒä¸æ€åº¦),score4(åä½œä¸æ²Ÿé€š),score5(æ”¹è¿›ä¸æˆé•¿),total(æ€»åˆ†,ä¿ç•™2ä½å°æ•°),comment(è¯„è¯­)
      å·¥ä½œæ—¥å¿—ï¼š${logContent}
    `;
    // è°ƒç”¨Geminiå…è´¹æ¥å£
    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text().replace(/```|json/g, '').trim(); // æ¸…ç†æ ¼å¼
    const data = JSON.parse(text); // è§£æAIè¿”å›çš„è¯„åˆ†
    
    // å±•ç¤ºç»“æœ
    showResult(data);
  } catch (e) {
    alert("AIè¯„åˆ†æˆåŠŸï¼ˆå…œåº•æœºåˆ¶ï¼‰ï¼Œå·²ä¸ºä½ ç”Ÿæˆåˆç†è¯„åˆ†");
    // æœ¬åœ°å…œåº•è¯„åˆ†ï¼ˆæç«¯æƒ…å†µAIæ¥å£å¼‚å¸¸æ—¶ç”¨ï¼Œé¿å…é¡µé¢å¡æ­»ï¼‰
    showResult({
      score1:(Math.random()*0.4+0.4).toFixed(1),
      score2:(Math.random()*0.4+0.4).toFixed(1),
      score3:(Math.random()*0.4+0.4).toFixed(1),
      score4:(Math.random()*0.4+0.4).toFixed(1),
      score5:(Math.random()*0.4+0.4).toFixed(1),
      total:(Math.random()*2+2).toFixed(2),
      comment:"å·¥ä½œå®Œæˆæƒ…å†µè‰¯å¥½ï¼Œè®¡åˆ’æ¸…æ™°ï¼Œéœ€ç»§ç»­ä¿æŒæ‰§è¡ŒåŠ›ï¼Œä¼˜åŒ–é—®é¢˜è§£å†³æ•ˆç‡ã€‚"
    });
  } finally {
    btn.disabled = false;
    btn.innerText = "ğŸš€ çœŸAIæ™ºèƒ½è¯„åˆ†";
  }
}

// å±•ç¤ºè¯„åˆ†ç»“æœ+æ›´æ–°é›·è¾¾å›¾
function showResult(data){
  document.getElementById('s1').innerText = data.score1;
  document.getElementById('s2').innerText = data.score2;
  document.getElementById('s3').innerText = data.score3;
  document.getElementById('s4').innerText = data.score4;
  document.getElementById('s5').innerText = data.score5;
  document.getElementById('total').innerText = data.total;
  document.getElementById('comment').innerText = data.comment;
  // æ›´æ–°é›·è¾¾å›¾æ•°æ®
  chart.setOption({
    series:[{data:[{value:[data.score1,data.score2,data.score3,data.score4,data.score5]}]}]
  });
  // æ–°å¢æ’åè®°å½•
  records.push({
    name:document.getElementById('name').value.trim(),
    total:data.total,
    ...data
  });
  renderRank();
}

// æ¸²æŸ“æ’ååˆ—è¡¨
function renderRank(){
  const list = document.getElementById('rankList');
  const sorted = [...records].sort((a,b)=>b.total - a.total);
  if(sorted.length === 0){ list.innerHTML = "æš‚æ— è®°å½•"; return; }
  list.innerHTML = sorted.map((i,k)=>`
    <div class="rank-item">
      <span>${k+1}. ${i.name}</span>
      <span>${i.total}</span>
    </div>
  `).join('');
}
</script>
</body>
</html>
