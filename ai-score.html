<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‘˜å·¥å·¥ä½œæ—¥å¿— - çœŸæ­£AIæ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#f7f8fa}
.container{max-width:1000px;margin:20px auto;padding:0 20px}
.header{background:#1677ff;color:white;padding:18px 20px;border-radius:14px}
.main{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0}
.card{background:white;padding:22px;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.05)}
.card h2{margin-bottom:16px;color:#1677ff}
.form-item{margin-bottom:14px}
label{display:block;margin-bottom:6px}
input,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px}
textarea{min-height:100px;resize:vertical}
.btn{width:100%;padding:12px;background:#1677ff;color:white;border:none;border-radius:10px;margin-top:10px;font-weight:bold;cursor:pointer;transition:background 0.2s}
.btn:disabled{background:#999;cursor:not-allowed}
.btn:hover:not(:disabled){background:#0d5bcd}
.score-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}
.radar{height:280px;margin:16px 0}
.rank-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #f2f2f2}
.rank-item:first-child{font-weight:bold;color:#1677ff}
.tips{color:#999;font-size:12px;margin-top:10px;text-align:center}
</style>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>å‘˜å·¥å·¥ä½œæ—¥å¿— - çœŸæ­£AIæ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ</h1>
  </div>
  <div class="main">
    <div class="card">
      <h2>ğŸ“ å·¥ä½œæ—¥å¿—</h2>
      <div class="form-item"><label>å§“å</label><input id="name" placeholder="è¯·è¾“å…¥å§“å"></div>
      <div class="form-item"><label>ä»Šæ—¥å®Œæˆå·¥ä½œ</label><textarea id="done" placeholder="è¯·è¯¦ç»†å¡«å†™ä»Šæ—¥å®Œæˆçš„å·¥ä½œå†…å®¹"></textarea></div>
      <div class="form-item"><label>æœªå®Œæˆå·¥ä½œ</label><textarea id="undone" placeholder="è¯·å¡«å†™æœªå®Œæˆçš„å·¥ä½œåŠåŸå› "></textarea></div>
      <div class="form-item"><label>é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</label><textarea id="problem" placeholder="è¯·å¡«å†™é‡åˆ°çš„é—®é¢˜åŠå¯¹åº”çš„è§£å†³åŠæ³•"></textarea></div>
      <div class="form-item"><label>æ˜æ—¥å·¥ä½œè®¡åˆ’</label><textarea id="plan" placeholder="è¯·å¡«å†™æ˜æ—¥çš„å·¥ä½œå®‰æ’ä¸è®¡åˆ’"></textarea></div>
      <button class="btn" onclick="submitAI()" id="btn">ğŸš€ çœŸæ­£AIæ™ºèƒ½è¯„åˆ†</button>
      <div class="tips">å·²æ¥å…¥Google Gemini å¤§æ¨¡å‹ï¼ŒçœŸå®AIè¯„åˆ†ï¼Œééšæœºéæœ¬åœ°è§„åˆ™</div>
    </div>
    <div class="card">
      <h2>ğŸ“Š AIè¯„åˆ†ç»“æœ</h2>
      <div style="text-align:center;margin:20px 0">
        <div style="font-size:42px;font-weight:bold;color:#00b42a" id="total">0.00</div>
        <div>æ€»åˆ†ï¼ˆ0~4.0ï¼‰</div>
      </div>
      <div class="score-item">å·¥ä½œå®Œæˆåº¦ <b id="s1">0.0</b></div>
      <div class="score-item">æ•ˆç‡ä¸æ‰§è¡ŒåŠ› <b id="s2">0.0</b></div>
      <div class="score-item">è´£ä»»å¿ƒä¸æ€åº¦ <b id="s3">0.0</b></div>
      <div class="score-item">åä½œä¸æ²Ÿé€š <b id="s4">0.0</b></div>
      <div class="score-item">æ”¹è¿›ä¸æˆé•¿ <b id="s5">0.0</b></div>
      <div id="radar" class="radar"></div>
      <p id="comment" style="margin-top:10px;line-height:1.6;color:#333"></p>
    </div>
  </div>
  <div class="card">
    <h2>ğŸ† å‘˜å·¥è¯„åˆ†æ’å</h2>
    <div id="rankList" style="padding:14px;text-align:center;color:#999">æš‚æ— è¯„åˆ†è®°å½•</div>
  </div>
</div>

<script>
// å…¨å±€å˜é‡
let chart;
let records = JSON.parse(localStorage.getItem('workScoreRecords')) || [];
// ä¸­è½¬æ¥å£åœ°å€ï¼Œå·²å¤„ç†è·¨åŸŸï¼Œç›´æ¥è°ƒç”¨
const AI_API_URL = "https://gemini-proxy.zeabur.app/ai/score";

// é¡µé¢åŠ è½½å®Œæˆåˆå§‹åŒ–
window.onload = () => {
  chart = echarts.init(document.getElementById('radar'));
  updateRadarChart([0, 0, 0, 0, 0]);
  renderRank();
  window.addEventListener('resize', () => chart.resize());
};

// æ›´æ–°é›·è¾¾å›¾
function updateRadarChart(data) {
  chart.setOption({
    radar: {
      indicator: [
        { name: 'å·¥ä½œå®Œæˆåº¦', max: 0.8 },
        { name: 'æ•ˆç‡ä¸æ‰§è¡ŒåŠ›', max: 0.8 },
        { name: 'è´£ä»»å¿ƒä¸æ€åº¦', max: 0.8 },
        { name: 'åä½œä¸æ²Ÿé€š', max: 0.8 },
        { name: 'æ”¹è¿›ä¸æˆé•¿', max: 0.8 }
      ],
      splitNumber: 4
    },
    series: [{
      type: 'radar',
      data: [{
        value: data,
        name: 'è¯„åˆ†ç»´åº¦',
        itemStyle: { color: '#1677ff' },
        areaStyle: { color: 'rgba(22, 119, 255, 0.2)' }
      }]
    }]
  }, true);
}

// æ ¸å¿ƒAIè¯„åˆ†é€»è¾‘
async function submitAI() {
  // è·å–è¡¨å•å†…å®¹
  const name = document.getElementById('name').value.trim();
  const done = document.getElementById('done').value.trim();
  const undone = document.getElementById('undone').value.trim();
  const problem = document.getElementById('problem').value.trim();
  const plan = document.getElementById('plan').value.trim();
  const btn = document.getElementById('btn');

  // åŸºç¡€æ ¡éªŒ
  if (!name) {
    alert('è¯·å¡«å†™å§“å');
    return;
  }
  if (!done) {
    alert('è¯·å¡«å†™ä»Šæ—¥å®Œæˆå·¥ä½œå†…å®¹');
    return;
  }

  // æŒ‰é’®ç¦ç”¨ï¼Œé˜²æ­¢é‡å¤æäº¤
  btn.disabled = true;
  btn.innerText = "AIè¯„åˆ†ä¸­â€¦";

  try {
    // è°ƒç”¨ä¸­è½¬AIæ¥å£ï¼ŒçœŸæ­£å¤§æ¨¡å‹è¯„åˆ†
    const response = await fetch(AI_API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: name,
        done: done,
        undone: undone,
        problem: problem,
        plan: plan
      })
    });

    if (!response.ok) {
      throw new Error(`æ¥å£è¯·æ±‚å¤±è´¥ï¼š${response.status}ï¼Œè¯·ç¨åé‡è¯•`);
    }

    const scoreData = await response.json();
    // æ¸²æŸ“è¯„åˆ†ç»“æœ
    showScoreResult(scoreData);

  } catch (error) {
    alert(`AIè¯„åˆ†å¤±è´¥ï¼š${error.message}\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–ç¨åé‡è¯•`);
  } finally {
    // æ¢å¤æŒ‰é’®çŠ¶æ€
    btn.disabled = false;
    btn.innerText = "ğŸš€ çœŸæ­£AIæ™ºèƒ½è¯„åˆ†";
  }
}

// æ¸²æŸ“è¯„åˆ†ç»“æœ
function showScoreResult(data) {
  // å¡«å……åˆ†æ•°
  document.getElementById('s1').innerText = data.score1;
  document.getElementById('s2').innerText = data.score2;
  document.getElementById('s3').innerText = data.score3;
  document.getElementById('s4').innerText = data.score4;
  document.getElementById('s5').innerText = data.score5;
  document.getElementById('total').innerText = data.total;
  document.getElementById('comment').innerText = data.comment;

  // æ›´æ–°é›·è¾¾å›¾
  updateRadarChart([
    parseFloat(data.score1),
    parseFloat(data.score2),
    parseFloat(data.score3),
    parseFloat(data.score4),
    parseFloat(data.score5)
  ]);

  // ä¿å­˜è®°å½•åˆ°æœ¬åœ°
  records.push({
    name: document.getElementById('name').value.trim(),
    total: data.total,
    time: new Date().toLocaleString()
  });
  localStorage.setItem('workScoreRecords', JSON.stringify(records));

  // æ›´æ–°æ’å
  renderRank();
}

// æ¸²æŸ“æ’ååˆ—è¡¨
function renderRank() {
  const rankList = document.getElementById('rankList');
  // æ— è®°å½•æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€
  if (records.length === 0) {
    rankList.innerHTML = "æš‚æ— è¯„åˆ†è®°å½•";
    return;
  }
  // æŒ‰æ€»åˆ†é™åºæ’åº
  const sortedRecords = [...records].sort((a, b) => parseFloat(b.total) - parseFloat(a.total));
  // æ¸²æŸ“æ’å
  rankList.innerHTML = sortedRecords.map((item, index) => `
    <div class="rank-item">
      <span>${index + 1}. ${item.name}</span>
      <span>${item.total} åˆ†</span>
    </div>
  `).join('');
}
</script>
</body>
</html>
